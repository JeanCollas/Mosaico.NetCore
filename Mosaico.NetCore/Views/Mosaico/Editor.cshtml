@{ 
    Layout = "_LayoutMosaico";
    ViewBag.BodyClass = "mo-standalone";
    ViewBag.BodyStyle = "";
}

@section HeadContent{
    <meta name="viewport" content="width=1024, initial-scale=1">

    <link rel="stylesheet" href="/mosaico/mosaico-material.min.css" />
    <link rel="stylesheet" href="/mosaico/vendor/notoregular/stylesheet.css" />

    <script src="/mosaico/vendor/jquery.min.js"></script>
    <script src="/mosaico/vendor/knockout.js"></script>
    <script src="/mosaico/vendor/jquery-ui.min.js"></script>
    <script src="/mosaico/vendor/jquery.ui.touch-punch.min.js"></script>
    <script src="/mosaico/vendor/load-image.all.min.js"></script>
    <script src="/mosaico/vendor/canvas-to-blob.min.js"></script>
    <script src="/mosaico/vendor/jquery.iframe-transport.js"></script>
    <script src="/mosaico/vendor/jquery.fileupload.js"></script>
    <script src="/mosaico/vendor/jquery.fileupload-process.js"></script>
    <script src="/mosaico/vendor/jquery.fileupload-image.js"></script>
    <script src="/mosaico/vendor/jquery.fileupload-validate.js"></script>
    <script src="/mosaico/vendor/knockout-jqueryui.min.js"></script>
    <script src="/mosaico/vendor/tinymce.min.js"></script>
    <script src="/mosaico/mosaico.min.js"></script>
    <script>
        $(function () {
            if (!Mosaico.isCompatible()) {
                alert('Update your browser!');
                return;
            }
            // var basePath = window.location.href.substr(0, window.location.href.lastIndexOf('/')).substr(window.location.href.indexOf('/','https://'.length));
            //var basePath = window.location.href;
            //if (basePath.lastIndexOf('#') > 0) basePath = basePath.substr(0, basePath.lastIndexOf('#'));
            //if (basePath.lastIndexOf('?') > 0) basePath = basePath.substr(0, basePath.lastIndexOf('?'));
            //if (basePath.lastIndexOf('/') > 0) basePath = basePath.substr(0, basePath.lastIndexOf('/'));

            // Full URL required for /dl (download and email test). Otherwise the links don't work.
            var url = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');
            console.log(url);

            var basePath = url + '/mosaico';
            var plugins;
            // A basic plugin that expose the "viewModel" object as a global variable.
            // plugins = [function(vm) {window.viewModel = vm;}];
            var ok = Mosaico.init({
                imgProcessorBackend: basePath + '/img/',
                emailProcessorBackend: basePath + '/dl/',
                titleToken: "MOSAICO Responsive Email Designer",
                fileuploadConfig: {
                    url: basePath + '/upload/',
                    // messages??
                }
            }, plugins);
            if (!ok) {
                console.log("Missing initialization hash, redirecting to main entrypoint");
                document.location = ".";
            }
        });
    </script>
}